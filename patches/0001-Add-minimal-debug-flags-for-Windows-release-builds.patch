From 4293c5ac558e918845b17c5f6b93ce01cfd78f49 Mon Sep 17 00:00:00 2001
From: Bernd Wachter <bwachter-tmw@lart.info>
Date: Thu, 28 Jan 2010 15:27:15 +0100
Subject: [PATCH] Add minimal debug flags for Windows release builds; move definition of flags to src/

---
 CMakeLists.txt     |    5 -----
 src/CMakeLists.txt |   11 +++++++++++
 2 files changed, 11 insertions(+), 5 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index f98e9f6..48e6378 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -11,11 +11,6 @@ SET(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/CMake/Modules)
 
 FIND_PACKAGE(Gettext)
 
-IF (CMAKE_COMPILER_IS_GNUCXX)
-    # Help getting compilation warnings
-    SET(CMAKE_CXX_FLAGS "-Wall")
-ENDIF()
-
 OPTION(WITH_OPENGL "Enable OpenGL support" ON)
 OPTION(ENABLE_NLS "Enable building of tranlations" ON)
 
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index e101db0..82befb2 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -10,6 +10,17 @@ FIND_PACKAGE(PhysFS REQUIRED)
 FIND_PACKAGE(PNG REQUIRED)
 FIND_PACKAGE(Gettext REQUIRED)
 
+IF (CMAKE_COMPILER_IS_GNUCXX)
+    # Help getting compilation warnings
+    SET(CMAKE_CXX_FLAGS "-Wall")
+    IF (WIN32)
+        # This includes enough debug information to get something useful
+        # from Dr. Mingw while keeping binary size down. Almost useless
+        # with gdb, though.
+        SET(CMAKE_CXX_FLAGS_RELWITHDEBINFO "-O2 -ggdb0 -gstabs2")
+    ENDIF()
+ENDIF()
+
 SET(FLAGS "-DPACKAGE_VERSION=\\\"${VERSION}\\\"")
 SET(FLAGS "${FLAGS} -DPKG_DATADIR=\\\"${PKG_DATADIR}/\\\"")
 SET(FLAGS "${FLAGS} -DLOCALEDIR=\\\"${LOCALEDIR}/\\\"")
-- 
1.5.6.5

