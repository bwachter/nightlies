TYPE=git
SOURCE=git://gitorious.org/mana/mana.git
CONFIGTOOL=cmake
PATCHES="0001-Add-win32-rc-handling-to-cmake-fix-icon-path.patch 0001-Add-support-for-MingW-crash-handler-define-DEBUG-fo.patch 0001-Add-minimal-debug-flags-for-Windows-release-builds.patch"
CONFIGFLAGS=-DCMAKE_BUILD_TYPE=RelWithDebInfo
VERSION=0.1.0.`date +%Y%m%d`

pkg_install(){
    cd $BASE/build/$NAME/po
    for i in *.gmo; do
        _LC=`echo $i|sed 's/\..*//'`
        mkdir -p ../translations/$_LC/LC_MESSAGES
        cp $i ../translations/$_LC/LC_MESSAGES/mana.mo
    done
    cd $BASE/build/$NAME/packaging/windows
    makensis -DDLLDIR=/build/tmw-libs/lib/ -DPRODUCT_VERSION=$VERSION -DUPX=true -DEXESUFFIX=/src -DCOMBINED_BUILD=1 setup.nsi
    if [ -d $TRANSFER/ ]; then
        mkdir -p $TRANSFER/$NAME
        mv *.exe $TRANSFER/$NAME/
        cd $BASE/build/$NAME/src/
        zip $TRANSFER/$NAME/mana-$VERSION.exe.zip mana.exe
        zip $TRANSFER/$NAME/mana-ea-$VERSION.exe.zip mana-ea.exe
    fi
}
